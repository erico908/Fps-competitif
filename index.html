<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Horror Night VR - Tir AK-47</title>
<style>
  body { margin: 0; overflow: hidden; background-color: #000; }
  #score { position: absolute; top: 10px; left: 10px; color: white; font-size: 24px; z-index: 10; }
  #shootBtn { position: absolute; bottom: 20px; right: 20px; width: 80px; height: 80px; border-radius: 50%; background: red; border: none; z-index: 10; }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<button id="shootBtn"></button>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<script>
let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

camera.position.set(0,1.6,0);

let light = new THREE.HemisphereLight(0xffffff,0x444444,1);
scene.add(light);

// ===== Sol simple =====
let ground = new THREE.Mesh(new THREE.PlaneGeometry(100,100), new THREE.MeshPhongMaterial({color:0x222222}));
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// ===== Mains et AK-47 =====
const gunGroup = new THREE.Group();
camera.add(gunGroup);
gunGroup.position.set(0,-0.2,-0.3);

// Mains
const handMat = new THREE.MeshPhongMaterial({color:0xffd1a4});
const leftHand = new THREE.Mesh(new THREE.BoxGeometry(0.2,0.5,0.2), handMat);
const rightHand = new THREE.Mesh(new THREE.BoxGeometry(0.2,0.5,0.2), handMat);
leftHand.position.set(-0.25,-0.2,-0.15); leftHand.rotation.x = -0.2;
rightHand.position.set(0.25,-0.2,-0.15); rightHand.rotation.x = -0.1;
gunGroup.add(leftHand,rightHand);

// AK-47
const gunMat = new THREE.MeshPhongMaterial({color:0x222222});
const barrel = new THREE.Mesh(new THREE.BoxGeometry(0.07,0.07,0.6), gunMat); barrel.position.set(0,0,0.35);
const stock = new THREE.Mesh(new THREE.BoxGeometry(0.07,0.07,0.25), gunMat); stock.position.set(0,0,-0.25);
const magazine = new THREE.Mesh(new THREE.BoxGeometry(0.08,0.15,0.12), gunMat); magazine.position.set(0,-0.1,0);
const handguard = new THREE.Mesh(new THREE.BoxGeometry(0.08,0.08,0.25), gunMat); handguard.position.set(0,0,0.1);
gunGroup.add(barrel,stock,magazine,handguard);

// Effet feu
const fireMat = new THREE.MeshBasicMaterial({color:0xffaa00});
const fire = new THREE.Mesh(new THREE.SphereGeometry(0.05,8,8), fireMat);
fire.visible=false;
gunGroup.add(fire);

// ===== Cibles =====
let targets = [];
for(let i=0;i<5;i++){
  let t = new THREE.Mesh(new THREE.BoxGeometry(0.5,0.5,0.5), new THREE.MeshPhongMaterial({color:0xff0000}));
  t.position.set(Math.random()*10-5,0.25,-Math.random()*10-5);
  scene.add(t);
  targets.push(t);
}

let score = 0;

// ===== Tir =====
function shoot(){
  fire.position.set(0,0,0.7);
  fire.visible = true;

  const origin = new THREE.Vector3(); 
  origin.setFromMatrixPosition(camera.matrixWorld);
  const dir = new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion).normalize();

  let closest=null, minDist=Infinity;
  for(let t of targets){
    if(!t.visible) continue;
    const toTarget = new THREE.Vector3().subVectors(t.position, origin);
    const distanceAlongDir = toTarget.dot(dir);
    if(distanceAlongDir>0){
      const perpendicularDist = toTarget.clone().sub(dir.clone().multiplyScalar(distanceAlongDir)).length();
      if(perpendicularDist<0.5 && distanceAlongDir<minDist){ closest=t; minDist=distanceAlongDir; }
    }
  }
  if(closest){
    closest.visible=false;
    score++;
    document.getElementById("score").innerText="Score: "+score;
  }

  setTimeout(()=>{ fire.visible=false; },100);
}

document.getElementById("shootBtn").addEventListener("pointerdown",shoot);

// ===== Boucle animation =====
function animate(){
  requestAnimationFrame(animate);
  renderer.render(scene,camera);
}
animate();

// ===== Redimensionnement =====
window.addEventListener('resize',()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>







































