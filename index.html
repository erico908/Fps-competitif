<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FPS Mobile Test</title>
<style>
  body { margin:0; overflow:hidden; touch-action:none; background:#000; }
  canvas { display:block; }

  /* Joystick */
  #joystickContainer {
    position:absolute; bottom:30px; left:30px; width:120px; height:120px;
    border-radius:50%; background:rgba(0,0,0,0.3);
    touch-action:none;
  }
  #joystick {
    position:absolute; width:60px; height:60px;
    left:30px; top:30px;
    border-radius:50%; background:rgba(255,255,255,0.7);
    touch-action:none;
  }

  /* Bouton sauter */
  #jumpBtn {
    position:absolute; bottom:50px; right:30px; padding:15px 25px;
    font-size:18px; background:orange; color:#fff; border:none; border-radius:10px;
  }

  /* Slider sensibilité */
  #sensiSlider {
    position:absolute; top:20px; right:20px;
  }
</style>
</head>
<body>
<div id="joystickContainer">
  <div id="joystick"></div>
</div>
<button id="jumpBtn">Sauter</button>
<input type="range" id="sensiSlider" min="0.5" max="5" value="2" step="0.1">

<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script>
let camera, scene, renderer;
let pitchObject, yawObject;
let velocity=new THREE.Vector3();
let prevTime=performance.now();
let pointerLocked=false;

// Déplacements
let moveForward=false, moveBackward=false, moveLeft=false, moveRight=false;
let jump=false, canJump=true;

// Sensibilité
let sensitivity = 2;

// Joystick
const joystickContainer = document.getElementById('joystickContainer');
const joystick = document.getElementById('joystick');
let joystickPos = {x:0,y:0};
let dragging = false;

joystick.addEventListener('pointerdown',(e)=>{
    dragging=true;
});
document.addEventListener('pointerup',(e)=>{
    dragging=false;
    joystick.style.left='30px'; joystick.style.top='30px';
    joystickPos={x:0,y:0};
});
document.addEventListener('pointermove',(e)=>{
    if(!dragging) return;
    const rect = joystickContainer.getBoundingClientRect();
    let x = e.clientX - rect.left - rect.width/2;
    let y = e.clientY - rect.top - rect.height/2;
    const max = rect.width/2;
    x = Math.max(-max, Math.min(max, x));
    y = Math.max(-max, Math.min(max, y));
    joystick.style.left = (30 + x)+'px';
    joystick.style.top = (30 + y)+'px';
    joystickPos = {x:x/max, y:-y/max};
});

// Slider sensibilité
document.getElementById('sensiSlider').addEventListener('input',(e)=>{
    sensitivity = parseFloat(e.target.value);
});

// Saut
document.getElementById('jumpBtn').addEventListener('click',()=>{
    if(canJump){
        velocity.y = 5;
        canJump=false;
    }
});

function init(){
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0xFFCC99); // ciel crépuscule approximatif

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

    // FPS controller
    pitchObject = new THREE.Object3D();
    pitchObject.add(camera);
    yawObject = new THREE.Object3D();
    yawObject.position.y = 2;
    yawObject.add(pitchObject);
    scene.add(yawObject);

    // Sol
    const floor = new THREE.Mesh(new THREE.PlaneGeometry(50,50), new THREE.MeshPhongMaterial({color:0x00FF00}));
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    // Murs
    const wallMat = new THREE.MeshPhongMaterial({color:0xFFA500});
    const walls = [
        new THREE.Mesh(new THREE.BoxGeometry(1,5,20), wallMat),
        new THREE.Mesh(new THREE.BoxGeometry(1,5,20), wallMat),
        new THREE.Mesh(new THREE.BoxGeometry(20,5,1), wallMat),
        new THREE.Mesh(new THREE.BoxGeometry(20,5,1), wallMat)
    ];
    walls[0].position.set(-10,2.5,0);
    walls[1].position.set(10,2.5,0);
    walls[2].position.set(0,2.5,-10);
    walls[3].position.set(0,2.5,10);
    walls.forEach(w=>scene.add(w));

    // Lumières
    const light = new THREE.DirectionalLight(0xffffff,1);
    light.position.set(5,10,7);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x404040));

    // Renderer
    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Bloquer zoom tactile
    renderer.domElement.addEventListener('wheel', e=>e.preventDefault(), {passive:false});

    // Glisser pour tourner caméra
    let lastTouch = null;
    renderer.domElement.addEventListener('touchstart', e=>{
        if(e.touches.length==1) lastTouch={x:e.touches[0].clientX, y:e.touches[0].clientY};
    });
    renderer.domElement.addEventListener('touchmove', e=>{
        if(e.touches.length!=1 || !lastTouch) return;
        const dx = e.touches[0].clientX - lastTouch.x;
        const dy = e.touches[0].clientY - lastTouch.y;
        yawObject.rotation.y -= dx*0.002*sensitivity;
        pitchObject.rotation.x -= dy*0.002*sensitivity;
        const PI_2 = Math.PI/2;
        pitchObject.rotation.x = Math.max(-PI_2, Math.min(PI_2, pitchObject.rotation.x));
        lastTouch={x:e.touches[0].clientX, y:e.touches[0].clientY};
    });
    renderer.domElement.addEventListener('touchend', e=>{ lastTouch=null; });

    window.addEventListener('resize', ()=>{
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Collision simple avec murs
    walls.forEach(w=>{
        w.geometry.computeBoundingBox();
        w.userData.box = w.geometry.boundingBox.clone();
    });
    yawObject.userData.box = new THREE.Box3(new THREE.Vector3(), new THREE.Vector3());
}

function animate(){
    requestAnimationFrame(animate);
    const time = performance.now();
    const delta = (time-prevTime)/1000;

    // Déplacement joystick
    const forward = new THREE.Vector3(0,0,-1).applyQuaternion(yawObject.quaternion); forward.y=0; forward.normalize();
    const right = new THREE.Vector3().crossVectors(forward,new THREE.Vector3(0,1,0)).normalize();

    let moveDir = new THREE.Vector3();
    moveDir.add(forward.clone().multiplyScalar(joystickPos.y*5*delta));
    moveDir.add(right.clone().multiplyScalar(joystickPos.x*5*delta));

    velocity.x = moveDir.x;
    velocity.z = moveDir.z;

    // Gravité
    velocity.y -= 9.8*delta;
    yawObject.position.add(velocity);

    // Collision sol simple
    if(yawObject.position.y<2){
        velocity.y=0;
        yawObject.position.y=2;
        canJump=true;
    }

    // Collision murs simple (AABB)
    // Approximation avec bounding box
    const playerBox = new THREE.Box3(
        new THREE.Vector3(yawObject.position.x-0.5, 0, yawObject.position.z-0.5),
        new THREE.Vector3(yawObject.position.x+0.5, 4, yawObject.position.z+0.5)
    );
    scene.children.forEach(obj=>{
        if(obj.userData.box){
            const wallBox = obj.userData.box.clone().translate(obj.position);
            if(playerBox.intersectsBox(wallBox)){
                // Recul simple
                yawObject.position.x -= velocity.x;
                yawObject.position.z -= velocity.z;
            }
        }
    });

    prevTime=time;
    renderer.render(scene,camera);
}

init();
animate();
</script>
</body>
</html>


































