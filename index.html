<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FPS Mobile Simple</title>
<style>
body { margin:0; overflow:hidden; touch-action:none; }
canvas { display:block; }
#joy { position:absolute; bottom:20px; left:20px; width:100px; height:100px; border-radius:50%; background:rgba(0,0,0,0.3); }
#knob { position:absolute; width:50px; height:50px; border-radius:50%; background:rgba(0,0,0,0.6); top:25px; left:25px; }
</style>
</head>
<body>
<div id="joy"><div id="knob"></div></div>
<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script>
// --- Scene ---
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);
let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// --- Contrôleur FPS simple ---
let pitchObject = new THREE.Object3D();
pitchObject.add(camera);
let yawObject = new THREE.Object3D();
yawObject.position.y = 2;
yawObject.add(pitchObject);
scene.add(yawObject);

// Sol simple
let floor = new THREE.Mesh(new THREE.PlaneGeometry(50,50), new THREE.MeshBasicMaterial({color:0x228B22}));
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// --- Joystick ---
let joy = document.getElementById('joy');
let knob = document.getElementById('knob');
let joyCenter = {x:0,y:0};
function computeCenter(){const r=joy.getBoundingClientRect(); joyCenter.x=r.left+r.width/2; joyCenter.y=r.top+r.height/2;}
computeCenter();
window.addEventListener('resize',computeCenter);

let joyId = null;
let moveX=0, moveY=0;

function setKnob(x,y){knob.style.left = (x-joy.offsetLeft-25)+'px'; knob.style.top = (y-joy.offsetTop-25)+'px';}
function resetKnob(){setKnob(joyCenter.x, joyCenter.y); moveX=0; moveY=0;}
function updateJoy(x,y){
    let dx = x-joyCenter.x, dy = y-joyCenter.y;
    let dist = Math.hypot(dx,dy);
    if(dist>50){ const s=50/dist; dx*=s; dy*=s; }
    setKnob(joyCenter.x+dx, joyCenter.y+dy);
    moveX = dx/50; moveY = -dy/50;
}

joy.addEventListener('pointerdown', e=>{ if(joyId===null){ joyId=e.pointerId; e.target.setPointerCapture && e.target.setPointerCapture(e.pointerId); updateJoy(e.clientX,e.clientY); }});
window.addEventListener('pointermove', e=>{ if(e.pointerId===joyId) updateJoy(e.clientX,e.clientY); });
window.addEventListener('pointerup', e=>{ if(e.pointerId===joyId){ joyId=null; resetKnob(); }});

// --- Caméra tactile ---
let lastTouch=null;
document.addEventListener('touchstart', e=>{ if(e.target===joy) return; lastTouch=e.touches[0]; });
document.addEventListener('touchmove', e=>{
    if(!lastTouch) return;
    const t = e.touches[0];
    const dx = t.clientX - lastTouch.clientX;
    const dy = t.clientY - lastTouch.clientY;
    yawObject.rotation.y -= dx*0.002;
    pitchObject.rotation.x -= dy*0.002;
    const PI2=Math.PI/2; pitchObject.rotation.x=Math.max(-PI2, Math.min(PI2, pitchObject.rotation.x));
    lastTouch=t;
});
document.addEventListener('touchend', e=>{ lastTouch=null; });

// --- Animation ---
function animate(){
    requestAnimationFrame(animate);
    // Mouvement joystick
    const forward = new THREE.Vector3(0,0,-1).applyQuaternion(yawObject.quaternion); forward.y=0; forward.normalize();
    const right = new THREE.Vector3().crossVectors(forward,new THREE.Vector3(0,1,0)).normalize();
    let dir = forward.clone().multiplyScalar(moveY*0.1).add(right.clone().multiplyScalar(moveX*0.1));
    yawObject.position.add(dir);
    renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
























