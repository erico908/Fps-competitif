<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FPS Mobile</title>
<style>
  body { margin:0; overflow:hidden; touch-action:none; }
  canvas { display:block; }
  #joystick { position:absolute; bottom:50px; left:50px; width:120px; height:120px; border-radius:50%; background:rgba(0,0,0,0.3); }
  #stick { position:absolute; width:60px; height:60px; border-radius:50%; background:rgba(255,255,255,0.7); top:30px; left:30px; }
  #jumpBtn { position:absolute; bottom:50px; right:50px; padding:20px; font-size:20px; background:rgba(255,255,255,0.7); border:none; border-radius:10px; }
  #sensiSlider { position:absolute; top:20px; right:20px; width:150px; }
</style>
</head>
<body>
<div id="joystick"><div id="stick"></div></div>
<button id="jumpBtn">Sauter</button>
<input type="range" id="sensiSlider" min="0.1" max="2" step="0.05" value="1">

<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script>
let camera, scene, renderer;
let pitchObject, yawObject;
let velocity = new THREE.Vector3();
let prevTime = performance.now();
let move = { forward:false, backward:false, left:false, right:false };
let jump = false;
let canJump = true;
let sensitivity = 1;

// --- Initialisation Three.js ---
function init(){
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x222244); // crépuscule

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

    pitchObject = new THREE.Object3D();
    pitchObject.add(camera);
    yawObject = new THREE.Object3D();
    yawObject.position.y = 2;
    yawObject.add(pitchObject);
    scene.add(yawObject);

    // Sol
    const floorMat = new THREE.MeshPhongMaterial({color:0x6e6e61});
    const floor = new THREE.Mesh(new THREE.PlaneGeometry(50,50), floorMat);
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    // Murs
    const wallMat = new THREE.MeshPhongMaterial({color:0xffffff});
    const walls = [
        new THREE.Mesh(new THREE.BoxGeometry(1,5,20), wallMat),
        new THREE.Mesh(new THREE.BoxGeometry(1,5,20), wallMat),
        new THREE.Mesh(new THREE.BoxGeometry(20,5,1), wallMat),
        new THREE.Mesh(new THREE.BoxGeometry(20,5,1), wallMat)
    ];
    walls[0].position.set(-10,2.5,0);
    walls[1].position.set(10,2.5,0);
    walls[2].position.set(0,2.5,-10);
    walls[3].position.set(0,2.5,10);
    walls.forEach(w=>scene.add(w));

    // Lumière
    const light = new THREE.DirectionalLight(0xffffff,1);
    light.position.set(5,10,7);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x404040));

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
}

// --- Joystick ---
let joystick = document.getElementById('joystick');
let stick = document.getElementById('stick');
let joystickPos = {x:0, y:0};
let joystickActive = false;

function getTouchPos(e){
    const rect = joystick.getBoundingClientRect();
    let touch = e.touches[0];
    let x = touch.clientX - rect.left - rect.width/2;
    let y = touch.clientY - rect.top - rect.height/2;
    let max = rect.width/2;
    x = Math.max(-max, Math.min(max, x));
    y = Math.max(-max, Math.min(max, y));
    return {x, y};
}

joystick.addEventListener('touchstart', e=>{ joystickActive=true; e.preventDefault(); });
joystick.addEventListener('touchmove', e=>{
    if(!joystickActive) return;
    let pos = getTouchPos(e);
    stick.style.transform = `translate(${pos.x}px, ${pos.y}px)`;
    joystickPos.x = pos.x/50; // normalisation
    joystickPos.y = -pos.y/50;
});
joystick.addEventListener('touchend', e=>{ joystickActive=false; stick.style.transform='translate(0px,0px)'; joystickPos.x=0; joystickPos.y=0; });

// --- Glisser la caméra ---
let dragging = false;
let lastTouch = null;
document.addEventListener('touchstart', e=>{
    if(e.target === joystick) return;
    dragging=true;
    lastTouch = {x:e.touches[0].clientX, y:e.touches[0].clientY};
});
document.addEventListener('touchmove', e=>{
    if(!dragging) return;
    let touch = e.touches[0];
    let dx = (touch.clientX - lastTouch.x)*0.002*sensitivity;
    let dy = (touch.clientY - lastTouch.y)*0.002*sensitivity;
    yawObject.rotation.y -= dx;
    pitchObject.rotation.x -= dy;
    pitchObject.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, pitchObject.rotation.x));
    lastTouch = {x:touch.clientX, y:touch.clientY};
});
document.addEventListener('touchend', e=>{ dragging=false; });

// --- Bouton sauter ---
document.getElementById('jumpBtn').addEventListener('touchstart', e=>{
    if(canJump){ jump=true; canJump=false; }
});

// --- Slider sensibilité ---
document.getElementById('sensiSlider').addEventListener('input', e=>{
    sensitivity = parseFloat(e.target.value);
});

// --- Animation ---
function animate(){
    requestAnimationFrame(animate);
    const time = performance.now();
    const delta = (time-prevTime)/1000;

    // Mouvement
    let forward = new THREE.Vector3(0,0,-1).applyQuaternion(yawObject.quaternion); forward.y=0; forward.normalize();
    let right = new THREE.Vector3().crossVectors(forward,new THREE.Vector3(0,1,0)).normalize();
    velocity.set(0,0,0);
    velocity.add(forward.clone().multiplyScalar(joystickPos.y*5*delta));
    velocity.add(right.clone().multiplyScalar(joystickPos.x*5*delta));

    // Saut
    if(jump){ velocity.y = 5; jump=false; }

    // Gravité
    velocity.y -= 9.8*delta;

    // Collision simple avec sol
    yawObject.position.add(velocity);
    if(yawObject.position.y<2){ yawObject.position.y=2; canJump=true; velocity.y=0; }

    // Collision murs simple AABB
    const pos = yawObject.position;
    if(pos.x<-9) pos.x=-9;
    if(pos.x>9) pos.x=9;
    if(pos.z<-9) pos.z=-9;
    if(pos.z>9) pos.z=9;

    prevTime=time;
    renderer.render(scene,camera);
}

// --- Lancer ---
init();
animate();
</script>
</body>
</html>

































