<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FPS Test</title>
<style>
  body { margin:0; overflow:hidden; }
  canvas { display:block; }
  #startBtn {
    position:absolute; top:50%; left:50%;
    transform:translate(-50%, -50%);
    padding:20px 40px; font-size:24px;
    cursor:pointer; z-index:100;
  }
</style>
</head>
<body>
<button id="startBtn">Commencer</button>
<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script>
let camera, scene, renderer;
let pitchObject, yawObject;
let moveForward=false, moveBackward=false, moveLeft=false, moveRight=false;
let velocity=new THREE.Vector3();
let prevTime=performance.now();
let pointerLocked=false;

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87ceeb);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

    // Contrôleur FPS
    pitchObject = new THREE.Object3D();
    pitchObject.add(camera);

    yawObject = new THREE.Object3D();
    yawObject.position.y = 2; // hauteur des yeux
    yawObject.add(pitchObject);
    scene.add(yawObject);

    // Sol
    const floor = new THREE.Mesh(new THREE.PlaneGeometry(50,50), new THREE.MeshPhongMaterial({color:0x228B22}));
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    // Murs simples
    const wallMat = new THREE.MeshPhongMaterial({color:0x8B4513});
    const wall1 = new THREE.Mesh(new THREE.BoxGeometry(1,5,20), wallMat); wall1.position.set(-10,2.5,0); scene.add(wall1);
    const wall2 = new THREE.Mesh(new THREE.BoxGeometry(1,5,20), wallMat); wall2.position.set(10,2.5,0); scene.add(wall2);
    const wall3 = new THREE.Mesh(new THREE.BoxGeometry(20,5,1), wallMat); wall3.position.set(0,2.5,-10); scene.add(wall3);
    const wall4 = new THREE.Mesh(new THREE.BoxGeometry(20,5,1), wallMat); wall4.position.set(0,2.5,10); scene.add(wall4);

    // Lumière
    const light = new THREE.DirectionalLight(0xffffff,1);
    light.position.set(5,10,7);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x404040));

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    document.addEventListener('keydown', onKeyDown);
    document.addEventListener('keyup', onKeyUp);
    document.addEventListener('mousemove', onMouseMove);

    document.addEventListener('pointerlockchange', () => {
        pointerLocked = (document.pointerLockElement === renderer.domElement);
    });

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
}

function onKeyDown(e){
    switch(e.key.toLowerCase()){
        case 'z': moveForward=true; break;
        case 's': moveBackward=true; break;
        case 'q': moveLeft=true; break;
        case 'd': moveRight=true; break;
    }
}
function onKeyUp(e){
    switch(e.key.toLowerCase()){
        case 'z': moveForward=false; break;
        case 's': moveBackward=false; break;
        case 'q': moveLeft=false; break;
        case 'd': moveRight=false; break;
    }
}

const PI_2 = Math.PI/2;
function onMouseMove(e){
    if(!pointerLocked) return;
    yawObject.rotation.y -= e.movementX*0.002;
    pitchObject.rotation.x -= e.movementY*0.002;
    pitchObject.rotation.x = Math.max(-PI_2, Math.min(PI_2, pitchObject.rotation.x));
}

function animate(){
    requestAnimationFrame(animate);
    const time = performance.now();
    const delta = (time - prevTime)/1000;
    velocity.set(0,0,0);

    const forward = new THREE.Vector3(0,0,-1).applyQuaternion(yawObject.quaternion); forward.y=0; forward.normalize();
    const right = new THREE.Vector3().crossVectors(forward,new THREE.Vector3(0,1,0)).normalize();

    if(moveForward) velocity.add(forward);
    if(moveBackward) velocity.sub(forward);
    if(moveRight) velocity.add(right);
    if(moveLeft) velocity.sub(right);

    if(velocity.length()>0) velocity.normalize().multiplyScalar(5*delta);

    yawObject.position.add(velocity);

    prevTime = time;
    renderer.render(scene, camera);
}

// Bouton Commencer
document.getElementById('startBtn').addEventListener('click', ()=>{
    init();
    animate();
    document.getElementById('startBtn').style.display='none';
    renderer.domElement.requestPointerLock();
});
</script>
</body>
</html>


















