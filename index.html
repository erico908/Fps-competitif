<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>FPS Mobile (Joystick Dynamique + Glisser Caméra)</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<style>
  body { margin:0; overflow:hidden; touch-action:none; background:#000; }
  canvas { display:block; width:100vw; height:100vh; }
  #stick { position:absolute; width:60px; height:60px; border-radius:50%; background:rgba(255,255,255,0.45); display:none; z-index:10; }
  #jumpBtn {
    position:absolute; bottom:18px; right:18px;
    width:80px; height:80px; border-radius:50%;
    background:rgba(255,255,255,0.35); text-align:center; font-size:24px;
    line-height:80px; color:#fff; z-index:10; user-select:none;
  }
  #reticle {
    position:absolute; pointer-events:none; z-index:20;
    left:50%; top:50%; width:16px; height:16px; margin-left:-8px; margin-top:-8px;
  }
  #reticle::before,#reticle::after{
    content:""; position:absolute; background:rgba(255,255,255,0.9);
  }
  #reticle::before{ left:7px; top:0;   width:2px; height:16px; }
  #reticle::after { left:0;   top:7px; width:16px; height:2px; }
</style>
</head>
<body>
<div id="stick"></div>
<div id="jumpBtn">↑</div>
<div id="reticle"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script>
// ---- Base Three.js -----
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

let camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);

let pitch = new THREE.Object3D();
pitch.add(camera);

let yaw = new THREE.Object3D();
yaw.position.set(0,1.8,0);
yaw.add(pitch);
scene.add(yaw);

const floor = new THREE.Mesh(new THREE.PlaneGeometry(40,40), new THREE.MeshPhongMaterial({color:0x228B22}));
floor.rotation.x = -Math.PI/2; scene.add(floor);

const wallMat = new THREE.MeshPhongMaterial({color:0x8B4513});
function addWall(w,h,d,x,z){const m=new THREE.Mesh(new THREE.BoxGeometry(w,h,d),wallMat);m.position.set(x,h/2,z);scene.add(m);}
addWall(20,4,1, 0,-10); // north
addWall(20,4,1, 0,10);  // south
addWall(1,4,20,-10,0);  // west
addWall(1,4,20, 10,0);  // east

scene.add(new THREE.DirectionalLight(0xffffff,1).position.set(5,10,7));
scene.add(new THREE.AmbientLight(0x404040));

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,1.5));
document.body.appendChild(renderer.domElement);

// ---- Joystick dynamique ----
let stick = document.getElementById("stick");
let joyId = null, joyStartX=0, joyStartY=0, joyDX=0, joyDY=0;
let MOVE_SPEED = 5;

window.addEventListener("pointerdown",e=>{
  // coté gauche → joystick / coté droit → look
  if(e.clientX < innerWidth/2){
    joyId = e.pointerId;
    joyStartX  = e.clientX;
    joyStartY  = e.clientY;
    stick.style.left = (joyStartX - 30)+"px";
    stick.style.top  = (joyStartY - 30)+"px";
    stick.style.display = "block";
  }
});

window.addEventListener("pointermove",e=>{
  if(e.pointerId === joyId){
    let dx = e.clientX - joyStartX;
    let dy = e.clientY - joyStartY;
    // clamp
    const max = 50;
    const dist = Math.hypot(dx,dy);
    if(dist>max){ const s=max/dist; dx*=s; dy*=s; }
    stick.style.left = (joyStartX + dx - 30)+"px";
    stick.style.top  = (joyStartY + dy - 30)+"px";
    joyDX = dx/max;
    joyDY = -dy/max;
  }
});

window.addEventListener("pointerup",e=>{
  if(e.pointerId === joyId){
    joyId=null;
    stick.style.display="none";
    joyDX=0; joyDY=0;
  }
});

// ---- Caméra - glisser coté droit ----
let lookId = null, lastX=0,lastY=0;
let SENS = 0.003;

window.addEventListener("pointerdown",e=>{
  if(e.clientX > innerWidth/2 && lookId==null){
    lookId=e.pointerId; lastX=e.clientX; lastY=e.clientY;
  }
});
window.addEventListener("pointermove",e=>{
  if(e.pointerId === lookId){
    let dx=e.clientX-lastX, dy=e.clientY-lastY;
    lastX=e.clientX; lastY=e.clientY;
    yaw.rotation.y -= dx*SENS;
    pitch.rotation.x -= dy*SENS;
    const lim=Math.PI/2; pitch.rotation.x=Math.max(-lim,Math.min(lim,pitch.rotation.x));
  }
});
window.addEventListener("pointerup",e=>{
  if(e.pointerId===lookId) lookId=null;
});

// ---- Jump ----
let velY = 0, onGround = true;
document.getElementById("jumpBtn").addEventListener("pointerdown",()=>{
  if(onGround){ velY = 5; onGround=false; }
});

// ---- Loop ----
let prev=performance.now();
function loop(){
  requestAnimationFrame(loop);
  let now=performance.now(), dt=(now-prev)/1000; prev=now;

  // déplacement
  let fwd = new THREE.Vector3(0,0,-1).applyQuaternion(yaw.quaternion); fwd.y=0; fwd.normalize();
  let right = new THREE.Vector3(1,0,0).applyQuaternion(yaw.quaternion); right.y=0; right.normalize();

  yaw.position.addScaledVector(fwd, joyDY*MOVE_SPEED*dt);
  yaw.position.addScaledVector(right, joyDX*MOVE_SPEED*dt);

  // gravité + jump
  velY -= 9.8*dt;
  yaw.position.y += velY*dt;
  if(yaw.position.y<1.8){ yaw.position.y=1.8; velY=0; onGround=true; }

  // collision simple
  yaw.position.x = Math.max(-9.5, Math.min(9.5, yaw.position.x));
  yaw.position.z = Math.max(-9.5, Math.min(9.5, yaw.position.z));

  renderer.render(scene, camera);
}
loop();
</script>
</body>
</html>



























