<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mini FPS</title>
  <style>
    body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
    #hud { position: absolute; top: 10px; left: 10px; color: white; z-index: 10; }
    .weapon-info, .ammo-info, .money-display { margin-bottom: 5px; }
    #weapon-selector { display: none; position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); padding: 10px; border-radius: 10px; }
    #menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
    .menu-button { padding: 15px 30px; margin: 10px; font-size: 18px; cursor: pointer; }
  </style>
</head>
<body>
  <div id="menu">
    <button class="menu-button" onclick="startGame('vsbots')">VS Bots</button>
    <button class="menu-button" onclick="startGame('suddendeath')">Mort subite</button>
  </div>

  <div id="hud" style="display:none;">
    <div class="weapon-info"></div>
    <div class="ammo-info"></div>
    <div class="money-display">$0</div>
    <button onclick="game.toggleWeaponSelector()">⚔️ Armes</button>
  </div>

  <div id="weapon-selector"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r160/three.min.js"></script>

  <script>
    class Game {
      constructor() {
        this.initScene();
        this.setupPlayer();
        this.spawnBots();
        this.animate();
      }

      initScene() {
        this.scene = new THREE.Scene();
        this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        this.renderer = new THREE.WebGLRenderer();
        this.renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(this.renderer.domElement);

        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 7);
        this.scene.add(light);

        const ground = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({color: 0x333333}));
        ground.rotation.x = -Math.PI/2;
        this.scene.add(ground);

        this.camera.position.set(0, 1.6, 5);
      }

      setupPlayer() {
        this.player = {
          health: 100,
          money: 0,
          currentWeapon: 'pistol',
          ammo: {
            ak47: { current: 30, total: 90 },
            awp: { current: 10, total: 30 },
            pistol: { current: 12, total: 36 },
            knife: { current: Infinity, total: Infinity }
          }
        };

        this.weapons = {
          ak47: { damage: 25, range: 50 },
          awp: { damage: 80, range: 100 },
          pistol: { damage: 15, range: 30 },
          knife: { damage: 50, range: 2 }
        };

        this.magSize = { ak47: 30, awp: 10, pistol: 12 };

        this.updateAmmoDisplay();
        document.querySelector('.weapon-info').textContent = this.player.currentWeapon.toUpperCase();
      }

      spawnBots() {
        this.bots = [];
        for (let i = 0; i < 5; i++) {
          this.createBot(new THREE.Vector3(i*3 - 6, 0, -10), i % 2 === 0 ? 'terrorist' : 'ct');
        }
      }

      createBot(position, type) {
        const mat = new THREE.MeshStandardMaterial({
          color: type === 'terrorist' ? 0xff4444 : 0x00b4db
        });

        const body = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 1.5, 8), mat);
        const head = new THREE.Mesh(new THREE.SphereGeometry(0.45, 12, 12), mat);
        head.position.y = 1.2;

        const bot = new THREE.Group();
        bot.add(body);
        bot.add(head);
        bot.position.copy(position);
        this.scene.add(bot);

        this.bots.push({ mesh: bot, health: 100, type, active: true });
      }

      toggleWeaponSelector() {
        const selector = document.getElementById('weapon-selector');
        const isHidden = getComputedStyle(selector).display === 'none';
        selector.style.display = isHidden ? 'block' : 'none';

        if (isHidden) {
          selector.innerHTML = '';
          Object.keys(this.weapons).forEach(w => {
            const btn = document.createElement('button');
            btn.textContent = w.toUpperCase();
            btn.onclick = () => { this.player.currentWeapon = w; this.updateAmmoDisplay(); document.querySelector('.weapon-info').textContent = w.toUpperCase(); selector.style.display = 'none'; };
            selector.appendChild(btn);
          });
        }
      }

      updateAmmoDisplay() {
        const w = this.player.currentWeapon;
        const ammo = this.player.ammo[w];
        if (w === 'knife') {
          document.querySelector('.ammo-info').textContent = '∞';
        } else {
          document.querySelector('.ammo-info').textContent = `${ammo.current} / ${ammo.total}`;
        }
      }

      shoot() {
        const w = this.player.currentWeapon;
        if (w !== 'knife' && this.player.ammo[w].current <= 0) return;

        if (w !== 'knife') this.player.ammo[w].current--;
        this.updateAmmoDisplay();

        this.checkHit();
      }

      checkHit() {
        const weapon = this.weapons[this.player.currentWeapon];
        const dir = new THREE.Vector3(0, 0, -1).applyQuaternion(this.camera.quaternion);
        const raycaster = new THREE.Raycaster(this.camera.position, dir, 0, weapon.range);

        const targets = this.bots.filter(b => b.active).map(b => b.mesh);
        const hits = raycaster.intersectObjects(targets, true);

        if (hits.length > 0) {
          const hitObj = hits[0].object;
          const botHit = this.bots.find(b => hitObj === b.mesh || b.mesh.children.includes(hitObj));
          if (botHit) {
            botHit.health -= weapon.damage;
            if (botHit.health <= 0) {
              botHit.active = false;
              botHit.mesh.visible = false;
              this.player.money += 300;
              document.querySelector('.money-display').textContent = '$' + this.player.money;
            }
          }
        }
      }

      reload() {
        const w = this.player.currentWeapon;
        if (w !== 'knife') {
          const size = this.magSize[w] ?? 30;
          const needed = size - this.player.ammo[w].current;
          if (needed > 0 && this.player.ammo[w].total > 0) {
            const take = Math.min(needed, this.player.ammo[w].total);
            this.player.ammo[w].current += take;
            this.player.ammo[w].total -= take;
            this.updateAmmoDisplay();
          }
        }
      }

      startGame(mode) {
        document.getElementById('menu').style.display = 'none';
        document.getElementById('hud').style.display = 'block';
        this.mode = mode;
      }

      animate() {
        requestAnimationFrame(() => this.animate());
        this.renderer.render(this.scene, this.camera);
      }
    }

    const game = new Game();
    window.startGame = (mode) => game.startGame(mode);

    window.addEventListener('click', () => game.shoot());
    window.addEventListener('keydown', (e) => { if (e.code === 'KeyR') game.reload(); });
  </script>
</body>
</html>






























