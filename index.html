<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mini CS Go Web</title>
<style>
  body { margin:0; overflow:hidden; background:#111; }
  canvas { display:block; }
  #info { position:absolute; top:10px; left:10px; color:white; font-family:sans-serif; z-index:10; }
  #start { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
           padding:20px; background:#333; color:white; font-size:20px; cursor:pointer; }
</style>
</head>
<body>
<div id="info">Score: <span id="score">0</span></div>
<div id="start">Cliquer pour commencer</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/examples/js/controls/PointerLockControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/nipplejs@0.11.0/dist/nipplejs.min.js"></script>

<script>
let scene, camera, renderer, controls;
let targets = [], bullets = [];
let score = 0;
let clock = new THREE.Clock();

// SCENE
scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

// CAMERA
camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,1.6,5);

// RENDERER
renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// LIGHT
let light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(10,10,10);
scene.add(light);
scene.add(new THREE.AmbientLight(0xffffff,0.3));

// SOL
let floorGeo = new THREE.BoxGeometry(50,1,50);
let floorMat = new THREE.MeshStandardMaterial({color:0x888888});
let floor = new THREE.Mesh(floorGeo,floorMat);
floor.position.y = -0.5;
scene.add(floor);

// MURS
function createWall(x,y,z,sx,sy,sz,color){
    let geo = new THREE.BoxGeometry(sx,sy,sz);
    let mat = new THREE.MeshStandardMaterial({color:color});
    let wall = new THREE.Mesh(geo,mat);
    wall.position.set(x,y,z);
    scene.add(wall);
}
createWall(0,1,-20,50,2,1,0x555555);
createWall(0,1,20,50,2,1,0x555555);
createWall(-25,1,0,1,2,50,0x555555);
createWall(25,1,0,1,2,50,0x555555);

// CONTROLS
controls = new THREE.PointerLockControls(camera, document.body);
document.getElementById('start').addEventListener('click', ()=>{
    controls.lock();
    document.getElementById('start').style.display='none';
});

// MOBILE JOYSTICK
let joystick = nipplejs.create({zone:document.body, mode:'static', position:{left:'80px', bottom:'80px'}, color:'white', size:80});
let move={forward:0,right:0};
joystick.on('move', (evt,data)=>{ move.forward = data.vector.y; move.right = data.vector.x; });
joystick.on('end', ()=>{ move.forward=0; move.right=0; });

// TIR
function shoot(){
    let geo = new THREE.SphereGeometry(0.05,8,8);
    let mat = new THREE.MeshBasicMaterial({color:0xff0000});
    let b = new THREE.Mesh(geo,mat);
    b.position.copy(camera.position);
    b.direction = new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion);
    bullets.push(b);
    scene.add(b);
}
window.addEventListener('click', shoot);

// CIBLES
function spawnTarget(){
    let geo = new THREE.BoxGeometry(0.5,0.5,0.5);
    let mat = new THREE.MeshStandardMaterial({color:0x00ff00});
    let t = new THREE.Mesh(geo,mat);
    t.position.set(Math.random()*40-20,0.25,Math.random()*40-20);
    scene.add(t);
    targets.push(t);
}
for(let i=0;i<10;i++){ spawnTarget(); }

// SCORE
function hitTarget(target){
    scene.remove(target);
    targets.splice(targets.indexOf(target),1);
    score++;
    document.getElementById('score').innerText = score;
}

// ANIMATION
function animate(){
    requestAnimationFrame(animate);
    let delta = clock.getDelta();

    // MOVE
    let speed = 5*delta;
    if(controls.isLocked){
        let dir = new THREE.Vector3();
        camera.getWorldDirection(dir);
        let right = new THREE.Vector3().crossVectors(camera.up,dir).normalize();
        camera.position.addScaledVector(dir,-move.forward*speed);
        camera.position.addScaledVector(right,move.right*speed);
    }

    // BULLETS
    bullets.forEach((b,i)=>{
        b.position.addScaledVector(b.direction,10*delta);
        targets.forEach(t=>{
            if(b.position.distanceTo(t.position)<0.3){
                hitTarget(t);
                scene.remove(b);
                bullets.splice(i,1);
            }
        });
        if(b.position.length()>100){ scene.remove(b); bullets.splice(i,1);}
    });

    renderer.render(scene,camera);
}
animate();

// RESIZE
window.addEventListener('resize',()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>












































