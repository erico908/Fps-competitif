<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>FPS Mobile</title>
<style>
  body { margin:0; overflow:hidden; touch-action:none; }
  canvas { display:block; }

  /* Joystick */
  #joystick { position:absolute; width:120px; height:120px; background:rgba(0,0,0,0.3); border-radius:50%; display:none; }
  #stick { position:absolute; width:60px; height:60px; background:rgba(0,0,0,0.6); border-radius:50%; top:30px; left:30px; touch-action:none; }

  /* Bouton sauter */
  #jumpBtn { position:absolute; bottom:50px; right:50px; width:80px; height:80px; background:orange; border-radius:50%; font-size:20px; text-align:center; line-height:80px; color:white; }

  /* Slider sensibilité */
  #sensiSlider { position:absolute; top:20px; right:20px; width:150px; }
</style>
</head>
<body>
<div id="joystick"><div id="stick"></div></div>
<button id="jumpBtn">Jump</button>
<input type="range" id="sensiSlider" min="0.1" max="2" value="1" step="0.1">

<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>

<script>
let camera, scene, renderer;
let pitchObject, yawObject;
let velocity = new THREE.Vector3();
let move = {forward:0, right:0};
let prevTime = performance.now();
let sensitivity = 1;
let canJump = false;

// Init Three.js
function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x2c3e50); // ciel crépuscule

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

    pitchObject = new THREE.Object3D();
    pitchObject.add(camera);

    yawObject = new THREE.Object3D();
    yawObject.position.y = 2;
    yawObject.add(pitchObject);
    scene.add(yawObject);

    // Sol vert
    const floor = new THREE.Mesh(new THREE.PlaneGeometry(50,50), new THREE.MeshPhongMaterial({color:0x00aa00}));
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    // Murs oranges
    const wallMat = new THREE.MeshPhongMaterial({color:0xff6600});
    const walls = [
        new THREE.Mesh(new THREE.BoxGeometry(1,5,20), wallMat),
        new THREE.Mesh(new THREE.BoxGeometry(1,5,20), wallMat),
        new THREE.Mesh(new THREE.BoxGeometry(20,5,1), wallMat),
        new THREE.Mesh(new THREE.BoxGeometry(20,5,1), wallMat)
    ];
    walls[0].position.set(-10,2.5,0);
    walls[1].position.set(10,2.5,0);
    walls[2].position.set(0,2.5,-10);
    walls[3].position.set(0,2.5,10);
    walls.forEach(w=>scene.add(w));

    // Lumière
    const light = new THREE.DirectionalLight(0xffffff,1);
    light.position.set(5,10,7);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x404040));

    renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    window.addEventListener('resize', onWindowResize);

    // Slider sensibilité
    document.getElementById('sensiSlider').addEventListener('input', e => sensitivity = parseFloat(e.target.value));

    // Jump
    document.getElementById('jumpBtn').addEventListener('touchstart', ()=>{ if(canJump){ velocity.y = 5; canJump=false; } });
}

function onWindowResize(){
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

// Joystick mobile qui apparaît là où on touche
let stick = document.getElementById('stick');
let joystick = document.getElementById('joystick');
let stickActive = false;
let startX, startY;

document.addEventListener('touchstart', e=>{
    const touch = e.touches[0];
    if(touch.clientX < window.innerWidth/2){
        // Joystick côté gauche
        stickActive = true;
        startX = touch.clientX;
        startY = touch.clientY;
        joystick.style.left = (startX-60) + 'px';
        joystick.style.top = (startY-60) + 'px';
        joystick.style.display = 'block';
    } else {
        // Caméra côté droit
        camActive = true;
        camPrevX = touch.clientX;
        camPrevY = touch.clientY;
    }
});

let camActive=false, camPrevX=0, camPrevY=0;

document.addEventListener('touchmove', e=>{
    for(let touch of e.touches){
        if(stickActive && touch.clientX < window.innerWidth/2){
            let dx = touch.clientX - startX;
            let dy = touch.clientY - startY;
            dx = Math.max(-50, Math.min(50, dx));
            dy = Math.max(-50, Math.min(50, dy));
            stick.style.transform = `translate(${dx}px, ${dy}px)`;
            move.forward = -dy/50;
            move.right = dx/50;
        }
        if(camActive && touch.clientX > window.innerWidth/2){
            let dx = (touch.clientX - camPrevX) * 0.008 * sensitivity;
            let dy = (touch.clientY - camPrevY) * 0.008 * sensitivity;
            yawObject.rotation.y -= dx;
            pitchObject.rotation.x -= dy;
            pitchObject.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, pitchObject.rotation.x));
            camPrevX = touch.clientX;
            camPrevY = touch.clientY;
        }
    }
});

document.addEventListener('touchend', e=>{
    stickActive = false;
    camActive = false;
    stick.style.transform = `translate(0px,0px)`;
    joystick.style.display='none';
    move.forward = 0;
    move.right = 0;
});

// Collision simple avec murs
function collide(pos){
    const limit = 9; 
    if(pos.x<-limit) pos.x=-limit;
    if(pos.x>limit) pos.x=limit;
    if(pos.z<-limit) pos.z=-limit;
    if(pos.z>limit) pos.z=limit;
}

// Animate
function animate(){
    requestAnimationFrame(animate);
    const time = performance.now();
    const delta = (time-prevTime)/1000;

    velocity.x = move.right*5;
    velocity.z = move.forward*5;
    velocity.y -= 9.8*delta; // gravité

    yawObject.position.x += velocity.x*delta;
    yawObject.position.y += velocity.y*delta;
    yawObject.position.z += velocity.z*delta;

    if(yawObject.position.y < 2){ yawObject.position.y=2; velocity.y=0; canJump=true; }
    collide(yawObject.position);

    prevTime=time;
    renderer.render(scene,camera);
}

init();
animate();
</script>
</body>
</html>






























