<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FPS Mobile — Joystick + Saut + Sensibilité</title>
<style>
html, body { margin:0; padding:0; overflow:hidden; height:100%; background:#000; touch-action:none; user-select:none; }
canvas { display:block; width:100%; height:100%; }
/* Joystick */
#joy { position:absolute; left:18px; bottom:18px; width:170px; height:170px; border-radius:50%; background:rgba(255,255,255,0.06); border:2px solid rgba(255,255,255,0.08); z-index:20; }
#knob { position:absolute; width:74px; height:74px; border-radius:50%; background:rgba(255,255,255,0.35); left:48px; top:48px; box-shadow:0 2px 10px rgba(0,0,0,0.6); }
/* Reticule */
#reticle { position:absolute; left:50%; top:50%; width:18px; height:18px; margin-left:-9px; margin-top:-9px; pointer-events:none; z-index:30; }
#reticle::before,#reticle::after { content:""; position:absolute; background:rgba(255,255,255,0.85); }
#reticle::before { left:8px; top:0; width:2px; height:18px; }
#reticle::after { left:0; top:8px; width:18px; height:2px; }
/* Bouton sauter */
#jumpBtn { position:absolute; right:18px; bottom:18px; width:80px; height:80px; border-radius:50%; background:rgba(255,255,255,0.25); border:2px solid #fff; font-size:30px; color:#fff; text-align:center; line-height:80px; z-index:20; user-select:none; }
/* Sensibilité */
#sensDiv { position:absolute; right:18px; top:18px; width:150px; color:#fff; font-family:Arial; font-size:12px; z-index:50; }
#sensSlider { width:100%; }
</style>
</head>
<body>

<div id="joy"><div id="knob"></div></div>
<div id="reticle"></div>
<div id="jumpBtn">↑</div>
<div id="sensDiv">Sensibilité:<input id="sensSlider" type="range" min="1" max="10" value="4"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script>
/* ========== Config ========== */
const JOY_SIZE = 170, KNOB_SIZE = 74, JOY_RADIUS = (JOY_SIZE - KNOB_SIZE)/2;
let MOVE_SPEED = 5, LOOK_SENS = 0.0035;
let GRAVITY = 9.8, JUMP_SPEED = 5;
let velocityY = 0, canJump = false;

/* ========== Scene ========== */
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);
let camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
let pitchObject = new THREE.Object3D();
pitchObject.add(camera);
let yawObject = new THREE.Object3D();
yawObject.position.set(0,1.8,0);
yawObject.add(pitchObject);
scene.add(yawObject);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setPixelRatio(Math.min(window.devicePixelRatio||1,1.5));
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

window.addEventListener('resize',()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});

/* ========== Floor & Walls ========== */
const floor = new THREE.Mesh(new THREE.PlaneGeometry(60,60), new THREE.MeshPhongMaterial({color:0x228B22}));
floor.rotation.x = -Math.PI/2;
scene.add(floor);

const wallMat = new THREE.MeshPhongMaterial({color:0x8B4513});
const thickness=1, height=4, half=10;
let walls=[];
walls.push(new THREE.Mesh(new THREE.BoxGeometry(half*2+thickness*2,height,thickness),wallMat));
walls.push(new THREE.Mesh(new THREE.BoxGeometry(half*2+thickness*2,height,thickness),wallMat));
walls.push(new THREE.Mesh(new THREE.BoxGeometry(thickness,height,half*2+thickness*2),wallMat));
walls.push(new THREE.Mesh(new THREE.BoxGeometry(thickness,height,half*2+thickness*2),wallMat));
walls[0].position.set(0,height/2,-half-thickness/2);
walls[1].position.set(0,height/2,half+thickness/2);
walls[2].position.set(-half-thickness/2,height/2,0);
walls[3].position.set(half+thickness/2,height/2,0);
walls.forEach(w=>scene.add(w));

window.walls = walls; // pour collision

/* ========== Lights ========== */
let dirLight = new THREE.DirectionalLight(0xffffff,1); dirLight.position.set(5,10,7); scene.add(dirLight);
scene.add(new THREE.AmbientLight(0x404040));

/* ========== Joystick ========== */
let joy=document.getElementById('joy'), knob=document.getElementById('knob');
let joyCenter={x:0,y:0};
function computeJoyCenter(){const r=joy.getBoundingClientRect(); joyCenter.x=r.left+r.width/2; joyCenter.y=r.top+r.height/2;}
computeJoyCenter(); window.addEventListener('resize',computeJoyCenter);
let joyId=null, joyX=0, joyY=0;
function setKnobPosition(px,py){ const r=joy.getBoundingClientRect(); knob.style.left=`${px-KNOB_SIZE/2-r.left}px`; knob.style.top=`${py-KNOB_SIZE/2-r.top}px`;}
function resetKnob(){knob.style.left=`${(joy.clientWidth-KNOB_SIZE)/2}px`; knob.style.top=`${(joy.clientHeight-KNOB_SIZE)/2}px`; }
function updateJoyFromPoint(cx,cy){ let dx=cx-joyCenter.x; let dy=cy-joyCenter.y; const dist=Math.hypot(dx,dy); const max=JOY_RADIUS; if(dist>max){ const s=max/dist; dx*=s; dy*=s; } setKnobPosition(joyCenter.x+dx, joyCenter.y+dy); joyX=dx/max; joyY=-dy/max; }
joy.addEventListener('pointerdown',e=>{const r=joy.getBoundingClientRect(); if(e.clientX>=r.left&&e.clientX<=r.right&&e.clientY>=r.top&&e.clientY<=r.bottom){joyId=e.pointerId; e.target.setPointerCapture&&e.target.setPointerCapture(e.pointerId); updateJoyFromPoint(e.clientX,e.clientY); e.preventDefault();}});
window.addEventListener('pointermove',e=>{if(joyId!==null&&e.pointerId===joyId){updateJoyFromPoint(e.clientX,e.clientY); e.preventDefault();}});
window.addEventListener('pointerup',e=>{if(joyId!==null&&e.pointerId===joyId){joyId=null; joyX=0; joyY=0; resetKnob();}});

/* ========== Look ========== */
let lookId=null, lastLookX=0,lastLookY=0;
window.addEventListener('pointerdown',e=>{if(e.clientX>innerWidth/2 && lookId===null){lookId=e.pointerId; lastLookX=e.clientX; lastLookY=e.clientY;}});
window.addEventListener('pointermove',e=>{if(lookId!==null && e.pointerId===lookId){ let dx=(e.clientX-lastLookX)*LOOK_SENS; let dy=(e.clientY-lastLookY)*LOOK_SENS; lastLookX=e.clientX; lastLookY=e.clientY; yawObject.rotation.y -= dx; pitchObject.rotation.x -= dy; pitchObject.rotation.x = Math.max(-Math.PI/2,Math.min(Math.PI/2,pitchObject.rotation.x)); }});
window.addEventListener('pointerup',e=>{if(lookId!==null && e.pointerId===lookId) lookId=null;});

/* ========== Sensibilité ========== */
document.getElementById('sensSlider').addEventListener('input',e=>{LOOK_SENS = 0.0007*e.target.value;});

/* ========== Jump ========== */
document.getElementById('jumpBtn').addEventListener('pointerdown',()=>{if(canJump){velocityY = JUMP_SPEED; canJump=false;}});

/* ========== Collision ========== */
function collide(position){
  const radius = 0.5;
  let pos = position.clone();
  walls.forEach(wall=>{
    const box = new THREE.Box3().setFromObject(wall);
    if(box.expandByScalar(radius).containsPoint(pos)){
      if(pos.x>box.min.x && pos.x<box.max.x && pos.z>box.min.z && pos.z<box.max.z){
        if(position.x>box.min.x && position.x<box.max.x) position.z = pos.z>position.z ? box.max.z+radius : box.min.z-radius;
        if(position.z>box.min.z && position.z<box.max.z) position.x = pos.x>position.x ? box.max.x+radius : box.min.x-radius;
      }
    }
  });
  return position;
}

/* ========== Movement ========== */
let move = new THREE.Vector3();
function animate(){
  requestAnimationFrame(animate);

  /* Movement */
  move.set(joyX,0,joyY);
  move.applyAxisAngle(new THREE.Vector3(0,1,0), yawObject.rotation.y);
  move.multiplyScalar(MOVE_SPEED*0.016);

  yawObject.position.add(move);

  /* Gravity */
  velocityY -= GRAVITY*0.016;
  yawObject.position.y += velocityY*0.016;

  if(yawObject.position.y<1.8){ yawObject.position.y=1.8; velocityY=0; canJump=true; }

  /* Collision */
  yawObject.position.copy(collide(yawObject.position));

  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>






















